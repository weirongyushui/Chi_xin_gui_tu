<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" placeholder="æœç´¢çº¢è‰²åŸºåœ°" value="{{searchKeyword}}" bindinput="onSearchInput" confirm-type="search" bindconfirm="onSearch"></input>
      <view class="search-btn" bindtap="onSearch" wx:if="{{searchKeyword}}">æœç´¢</view>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-section">
    <scroll-view class="filter-scroll" scroll-x="true" show-scrollbar="false">
      <view class="filter-item {{selectedProvince === '' ? 'active' : ''}}" bindtap="selectProvince" data-province="">
        å…¨éƒ¨
      </view>
      <view wx:for="{{provinces}}" wx:key="*this" class="filter-item {{selectedProvince === item ? 'active' : ''}}" bindtap="selectProvince" data-province="{{item}}">
        {{item}}
      </view>
    </scroll-view>
    
    <view class="sort-section">
      <text class="sort-label">æ’åºï¼š</text>
      <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}" range-key="label">
        <view class="sort-picker">
          <text>{{sortOptions[sortIndex].label}}</text>
          <text class="sort-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- åŸºåœ°åˆ—è¡¨ -->
  <view class="bases-container">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-section">
      <loading></loading>
      <text class="loading-text">æ­£åœ¨åŠ è½½...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{filteredBases.length === 0}}" class="empty-section">
      <view class="empty-icon">ğŸ“</view>
      <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³åŸºåœ°' : 'æš‚æ— çº¢è‰²åŸºåœ°'}}</text>
      <view class="empty-actions" wx:if="{{searchKeyword || selectedProvince}}">
        <button class="btn-secondary" bindtap="clearFilters">æ¸…é™¤ç­›é€‰</button>
      </view>
    </view>

    <!-- åŸºåœ°åˆ—è¡¨ -->
    <view wx:else class="bases-list">
      <view class="list-header">
        <text class="result-count">å…±æ‰¾åˆ° {{filteredBases.length}} ä¸ªçº¢è‰²åŸºåœ°</text>
        <view class="view-mode">
          <text class="mode-btn {{viewMode === 'list' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="list">ğŸ“‹</text>
          <text class="mode-btn {{viewMode === 'grid' ? 'active' : ''}}" bindtap="switchViewMode" data-mode="grid">âŠ</text>
        </view>
      </view>

      <!-- åˆ—è¡¨è§†å›¾ -->
      <view wx:if="{{viewMode === 'list'}}" class="list-view">
        <view wx:for="{{filteredBases}}" wx:key="id" class="base-item" bindtap="goToDetail" data-id="{{item.id}}">
          <view class="base-image-container">
            <image wx:if="{{item.images && item.images.length > 0}}" src="{{item.images[0]}}" class="base-image" mode="aspectFill"></image>
            <view wx:else class="base-default-image">
              <text class="default-icon">ğŸ›ï¸</text>
            </view>
            <view class="image-badges">
              <text class="rating-badge">â­ {{item.rating}}</text>
            </view>
          </view>
          
          <view class="base-content">
            <view class="base-header">
              <text class="base-name">{{item.name}}</text>
              <text class="base-province">{{item.province}}</text>
            </view>
            
            <text class="base-address">ğŸ“ {{item.address}}</text>
            <text class="base-description">{{item.description}}</text>
            
            <view class="base-meta">
              <text class="visit-count">ğŸ‘¥ {{item.visitCount}}äººå‚è§‚</text>
              <text class="ticket-info">ğŸ« {{item.ticketInfo}}</text>
            </view>
            
            <view class="base-actions">
              <view class="action-btn" bindtap="makeCall" data-phone="{{item.phone}}" catchtap="true">
                <text class="action-icon">ğŸ“</text>
                <text class="action-text">å’¨è¯¢</text>
              </view>
              <view class="action-btn" bindtap="openMap" data-item="{{item}}" catchtap="true">
                <text class="action-icon">ğŸ—ºï¸</text>
                <text class="action-text">å¯¼èˆª</text>
              </view>
              <view class="action-btn primary" bindtap="goToBooking" data-id="{{item.id}}" catchtap="true">
                <text class="action-icon">ğŸ«</text>
                <text class="action-text">é¢„çº¦</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- ç½‘æ ¼è§†å›¾ -->
      <view wx:else class="grid-view">
        <view wx:for="{{filteredBases}}" wx:key="id" class="grid-item" bindtap="goToDetail" data-id="{{item.id}}">
          <view class="grid-image-container">
            <image wx:if="{{item.images && item.images.length > 0}}" src="{{item.images[0]}}" class="grid-image" mode="aspectFill"></image>
            <view wx:else class="grid-default-image">
              <text class="grid-default-icon">ğŸ›ï¸</text>
            </view>
            <view class="grid-badges">
              <text class="grid-rating">â­ {{item.rating}}</text>
            </view>
          </view>
          
          <view class="grid-content">
            <text class="grid-name">{{item.name}}</text>
            <text class="grid-province">{{item.province}} {{item.city}}</text>
            <text class="grid-visit-count">ğŸ‘¥ {{item.visitCount}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿå®šä½ -->
  <view class="quick-location" bindtap="scrollToUserLocation" wx:if="{{userProvince && filteredBases.length > 0}}">
    <text class="location-icon">ğŸ“</text>
    <text class="location-text">{{userProvince}}</text>
  </view>
</view>